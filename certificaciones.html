<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Certificados y Proveedores | FIPTRAC</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Tipografía -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* =========================================================
   ESTILOS GENERALES
   ========================================================= */
body{
  font-family: Montserrat, sans-serif;
  background:#f4f6f8;
  margin:0;
}

/* =========================================================
   FILTROS
   ========================================================= */
.filtros{
  background:#fff;
  max-width:1200px;
  margin:-40px auto 40px;
  padding:25px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:18px;
}

.filtros select,
.filtros button{
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
}

.filtros button{
  background:#003A70;
  color:#fff;
  border:none;
  cursor:pointer;
}

/* =========================================================
   DIRECTORIO
   ========================================================= */
.directorio{
  max-width:1200px;
  margin:20px auto 80px;
  padding:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:30px;
}

/* =========================================================
   CARD DE PROVEEDOR
   ========================================================= */
.card{
  background:#fff;
  border-radius:18px;
  padding:22px;
  box-shadow:0 8px 22px rgba(0,0,0,.1);
  transition:.25s;
}

.card:hover{
  transform:translateY(-6px);
  box-shadow:0 14px 30px rgba(0,0,0,.16);
}

.card h3{
  color:#003A70;
  margin-bottom:6px;
}

.card p{
  font-size:14px;
  color:#444;
  margin:4px 0;
}

.badge{
  display:inline-block;
  background:#e8eef5;
  color:#003A70;
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  margin-top:6px;
}

.btns{
  display:flex;
  gap:10px;
  margin-top:14px;
}

.btn{
  flex:1;
  text-align:center;
  background:#003A70;
  color:#fff;
  padding:10px;
  border-radius:10px;
  text-decoration:none;
  cursor:pointer;
  font-size:14px;
}

/* =========================================================
   CTA
   ========================================================= */
.cta{
  background:#003A70;
  color:#fff;
  padding:50px 20px;
  text-align:center;
}

.cta button{
  margin-top:14px;
  padding:14px 26px;
  font-size:16px;
  border-radius:14px;
  border:none;
  background:#fff;
  color:#003A70;
  cursor:pointer;
}

/* =========================================================
   POPUP SOLICITUD
   ========================================================= */
.popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.popup-card{
  background:#fff;
  width:92%;
  max-width:520px;
  padding:28px;
  border-radius:20px;
}

.popup-card h3{
  color:#003A70;
  text-align:center;
}

.popup-card input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #ccc;
}
</style>
</head>

<body>

<!-- =========================================================
     FILTROS
     ========================================================= -->
<div class="filtros">
  <select id="fPais"><option value="">País</option></select>
  <select id="fEstado"><option value="">Estado</option></select>
  <select id="fServicio"><option value="">Servicio</option></select>
  <select id="fCertificado"><option value="">Certificación</option></select>
  <button onclick="aplicarFiltros()">Filtrar</button>
</div>

<!-- =========================================================
     DIRECTORIO
     ========================================================= -->
<section class="directorio">
  <div class="grid" id="grid"></div>
</section>

<!-- =========================================================
     CTA
     ========================================================= -->
<section class="cta">
  <h2>¿Eres proveedor certificado?</h2>
  <p>Solicita tu alta para aparecer en el directorio oficial</p>
  <button onclick="abrirPopupCertificados()">Solicitar registro</button>
</section>

<!-- =========================================================
     POPUP SOLICITUD
     ========================================================= -->
<div class="popup" id="popupCertificados">
  <div class="popup-card">
    <h3>Solicitud de alta</h3>

    <!-- Campos del formulario -->
    <input id="empresa" placeholder="Empresa" required>
    <input id="pais" placeholder="País" required>
    <input id="estado" placeholder="Estado" required>
    <input id="servicio" placeholder="Servicio" required>
    <input id="certificado" placeholder="Certificación" required>
    <input id="telefono" placeholder="Teléfono">
    <input id="correo" placeholder="Correo" type="email" required>

    <button class="btn" onclick="enviarSolicitud()">Enviar solicitud</button>
  </div>
</div>

<!-- =========================================================
     JAVASCRIPT
     ========================================================= -->
<script>
/* =========================================================
   CONFIGURACIÓN
   ========================================================= */

// URL del Apps Script (CAMBIAR POR LA REAL)
const API = "API_CERTIFICADOS";

// Array global con proveedores aprobados
let dataGlobal = [];

/* =========================================================
   CARGA DE DATOS DESDE GOOGLE SHEETS
   ========================================================= */
fetch(API)
  .then(r => r.json())
  .then(data => {
    // Solo mostramos proveedores APROBADOS
    dataGlobal = data.filter(d => d.ALTA === "APROBADO");
    render(dataGlobal);
    cargarFiltros(dataGlobal);
  });

/* =========================================================
   RENDERIZAR CARDS
   ========================================================= */
function render(data){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  // Si no hay resultados
  if(!data.length){
    grid.innerHTML = "<p>No hay resultados con los filtros seleccionados.</p>";
    return;
  }

  // Crear tarjetas
  data.forEach(p=>{
    grid.innerHTML += `
      <div class="card">
        <h3>${p.EMPRESA}</h3>
        <p>${p.PAÍS} · ${p.ESTADO}</p>
        <span class="badge">${p.SERVICIO}</span>
        <span class="badge">${p.CERTIFICADO}</span>
        <div class="btns">
          <a class="btn" href="mailto:${p.CORREO}">Contactar</a>
        </div>
      </div>
    `;
  });
}

/* =========================================================
   CARGAR OPCIONES DE FILTROS
   ========================================================= */
function cargarFiltros(data){
  const map = {
    PAÍS: fPais,
    ESTADO: fEstado,
    SERVICIO: fServicio,
    CERTIFICADO: fCertificado
  };

  Object.keys(map).forEach(k=>{
    [...new Set(data.map(d => d[k]).filter(Boolean))]
      .forEach(v => {
        map[k].innerHTML += `<option value="${v}">${v}</option>`;
      });
  });
}

/* =========================================================
   APLICAR FILTROS
   ========================================================= */
function aplicarFiltros(){
  const filtrados = dataGlobal.filter(d =>
    (!fPais.value || d.PAÍS === fPais.value) &&
    (!fEstado.value || d.ESTADO === fEstado.value) &&
    (!fServicio.value || d.SERVICIO === fServicio.value) &&
    (!fCertificado.value || d.CERTIFICADO === fCertificado.value)
  );
  render(filtrados);
}

/* =========================================================
   POPUP
   ========================================================= */
function abrirPopupCertificados(){
  popupCertificados.style.display = "flex";
}

// Cerrar al dar click fuera
popupCertificados.onclick = e => {
  if(e.target === popupCertificados){
    popupCertificados.style.display = "none";
  }
};

/* =========================================================
   ENVÍO DE SOLICITUD
   ========================================================= */
function enviarSolicitud(){

  // Validación básica
  if(!empresa.value || !pais.value || !estado.value || 
     !servicio.value || !certificado.value || !correo.value){
    alert("Completa todos los campos obligatorios");
    return;
  }

  // Enviar datos al Apps Script
  fetch(API,{
    method:"POST",
    body: JSON.stringify({
      EMPRESA: empresa.value,
      PAÍS: pais.value,
      ESTADO: estado.value,
      SERVICIO: servicio.value,
      CERTIFICADO: certificado.value,
      TELÉFONO: telefono.value,
      CORREO: correo.value
    })
  }).then(()=>{
    alert("Solicitud enviada correctamente");
    popupCertificados.style.display="none";
    document.querySelectorAll("#popupCertificados input").forEach(i=>i.value="");
  });
}
</script>

</body>
</html>
