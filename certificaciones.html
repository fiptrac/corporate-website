<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Certificados y Proveedores | FIPTRAC</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Montserrat,sans-serif;
  background:#f4f6f8;
  margin:0;
}

/* ================= HERO ================= */
.hero{
  background:linear-gradient(rgba(0,58,112,.82),rgba(0,58,112,.82));
  color:#fff;
  padding:90px 20px 50px;
  text-align:center;
}
.hero h1{font-size:36px;margin-bottom:10px}
.hero p{font-size:18px;max-width:900px;margin:auto}

/* ================= FILTROS ================= */
.filtros{
  background:#fff;
  max-width:1200px;
  margin:-40px auto 40px;
  padding:25px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:18px;
}
.filtros select,
.filtros button{
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
}
.filtros button{
  background:#003A70;
  color:#fff;
  border:none;
  cursor:pointer;
}

/* ================= GRID ================= */
.directorio{
  max-width:1200px;
  margin:20px auto 80px;
  padding:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:30px;
}

/* ================= CARD ================= */
.card{
  background:#fff;
  border-radius:18px;
  padding:22px;
  box-shadow:0 8px 22px rgba(0,0,0,.1);
  transition:.25s;
}
.card:hover{
  transform:translateY(-6px);
  box-shadow:0 14px 30px rgba(0,0,0,.16);
}
.card h3{color:#003A70;margin-bottom:6px}
.card p{font-size:14px;color:#444;margin:4px 0}
.badge{
  display:inline-block;
  background:#e8eef5;
  color:#003A70;
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  margin-top:6px;
}
.card .btns{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.btn{
  flex:1;
  text-align:center;
  background:#003A70;
  color:#fff;
  padding:10px;
  border-radius:10px;
  text-decoration:none;
  cursor:pointer;
  font-size:14px;
}
.btn.secondary{
  background:#555;
}

/* ================= CTA ================= */
.cta{
  background:#003A70;
  color:#fff;
  padding:50px 20px;
  text-align:center;
}
.cta button{
  margin-top:14px;
  padding:14px 26px;
  font-size:16px;
  border-radius:14px;
  border:none;
  background:#fff;
  color:#003A70;
  cursor:pointer;
}

/* ================= POPUP ================= */
.popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.popup-card{
  background:#fff;
  width:92%;
  max-width:520px;
  padding:28px;
  border-radius:20px;
}
.popup-card h3{color:#003A70;text-align:center}
.popup-card input, .popup-card select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #ccc;
}
</style>
</head>

<body>

<!-- HERO -->
<section class="hero">
  <h1>Directorio de Proveedores Certificados</h1>
  <p>Consulta y contacta proveedores avalados por FIPTRAC, filtrando por ubicación, servicios y certificaciones.</p>
</section>

<!-- FILTROS -->
<div class="filtros">
  <select id="fPais"><option value="">País</option></select>
  <select id="fEstado"><option value="">Estado</option></select>
  <select id="fServicio"><option value="">Servicio</option></select>
  <select id="fCertificado"><option value="">Certificación</option></select>
  <button onclick="aplicarFiltros()">Filtrar</button>
</div>

<!-- DIRECTORIO -->
<section class="directorio">
  <div class="grid" id="grid"></div>
</section>

<!-- CTA -->
<section class="cta">
  <h2>¿Eres proveedor certificado?</h2>
  <p>Solicita tu alta para aparecer en el directorio oficial</p>
  <button onclick="abrirPopup()">Solicitar registro</button>
</section>

<!-- POPUP ALTA -->
<div class="popup" id="popup">
  <div class="popup-card">
    <h3>Solicitud de alta</h3>
    <input id="empresa" placeholder="Empresa">
    <input id="pais" placeholder="País">
    <input id="estado" placeholder="Estado">
    <input id="servicio" placeholder="Servicio">
    <input id="certificado" placeholder="Certificación">
    <input id="telefono" placeholder="Teléfono">
    <input id="correo" placeholder="Correo">
    <button class="btn" onclick="enviarSolicitud()">Enviar solicitud</button>
  </div>
</div>

<script>
const API = "API_CERTIFICADOS";
let dataGlobal = [];

fetch(API).then(r=>r.json()).then(data=>{
  dataGlobal = data.filter(d=>d.ALTA==="APROBADO");
  render(dataGlobal);
  cargarFiltros(dataGlobal);
});

function render(data){
  const g=document.getElementById("grid");
  g.innerHTML="";
  data.forEach(p=>{
    g.innerHTML+=`
      <div class="card">
        <h3>${p.EMPRESA}</h3>
        <p>${p.PAÍS} · ${p.ESTADO}</p>
        <span class="badge">${p.SERVICIO}</span>
        <span class="badge">${p.CERTIFICADO}</span>
        <div class="btns">
          <a class="btn" href="mailto:${p.CORREO}">Contactar</a>
        </div>
      </div>`;
  });
}

function cargarFiltros(data){
  ["PAÍS","ESTADO","SERVICIO","CERTIFICADO"].forEach(k=>{
    const sel=document.getElementById("f"+k.charAt(0)+k.slice(1).toLowerCase());
    [...new Set(data.map(d=>d[k]))].forEach(v=>{
      sel.innerHTML+=`<option>${v}</option>`;
    });
  });
}

function aplicarFiltros(){
  const f = d => 
    (!fPais.value||d.PAÍS===fPais.value) &&
    (!fEstado.value||d.ESTADO===fEstado.value) &&
    (!fServicio.value||d.SERVICIO===fServicio.value) &&
    (!fCertificado.value||d.CERTIFICADO===fCertificado.value);
  render(dataGlobal.filter(f));
}

function abrirPopup(){popup.style.display="flex"}
popup.onclick=e=>{if(e.target===popup)popup.style.display="none"}

function enviarSolicitud(){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      ALTA:"SOLICITUD",
      EMPRESA:empresa.value,
      PAÍS:pais.value,
      ESTADO:estado.value,
      SERVICIO:servicio.value,
      CERTIFICADO:certificado.value,
      TELÉFONO:telefono.value,
      CORREO:correo.value
    })
  }).then(()=>{
    alert("Solicitud enviada correctamente");
    popup.style.display="none";
  });
}
</script>

</body>
</html>
