<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Certificados | FIPTRAC</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* ================== BASE ================== */
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:#020617;
  color:#e5e7eb;
}

/* ================== CONTENEDOR ================== */
.certificados{
  max-width:1300px;
  margin:auto;
  padding:120px 20px 60px;
}

/* ================== FILTROS ================== */
.filters{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
  margin-bottom:30px;
}

select,input{
  background:#111827;
  border:1px solid #1f2937;
  color:#e5e7eb;
  padding:12px;
  border-radius:10px;
  font-size:14px;
}

.btn{
  background:#ef4444;
  border:none;
  color:#fff;
  padding:12px;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
}
.btn:hover{ background:#dc2626 }

/* ================== GRID ================== */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:22px;
}

.card{
  background:linear-gradient(180deg,#111827,#020617);
  border:1px solid #1f2937;
  border-radius:18px;
  padding:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.card h4{
  margin:0 0 8px;
  font-size:17px;
  color:#fff;
}
.card p{
  margin:5px 0;
  font-size:14px;
  color:#9ca3af;
}

/* ================== POPUP ================== */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(6px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.popup-card{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:22px;
  padding:30px;
  width:100%;
  max-width:480px;
  position:relative;
}

.popup-card h3{
  margin:0 0 18px;
}

.popup-card form{
  display:grid;
  gap:14px;
}

.close-btn{
  position:absolute;
  top:14px;
  right:16px;
  font-size:20px;
  background:none;
  border:none;
  color:#9ca3af;
  cursor:pointer;
}
</style>
</head>

<body>

<section class="certificados">

  <!-- FILTROS -->
  <div class="filters">
    <select id="pais"><option>País</option></select>
    <select id="entidad"><option>Entidad</option></select>
    <select id="certificacion"><option>Certificado</option></select>
    <button class="btn" onclick="abrirFormulario()">Solicitar Registro</button>
  </div>

  <!-- GRID -->
  <div class="grid" id="grid"></div>
</section>

<!-- POPUP -->
<div class="popup" id="popup">
  <div class="popup-card">
    <button class="close-btn" onclick="cerrar()">✕</button>
    <h3>Solicitud de Alta</h3>

    <form id="form">
      <select id="fPais" required></select>
      <select id="fEntidad" required></select>

      <select id="fCert" required></select>
      <input id="otroCert" placeholder="OTRO CERTIFICADO" style="display:none">

      <input id="servicio" placeholder="SERVICIO (CORTO)" required>
      <input name="EMPRESA" placeholder="EMPRESA" required>
      <input name="TELÉFONO" placeholder="TELÉFONO" required>
      <input name="CORREO" type="email" placeholder="CORREO" required>

      <button class="btn">Enviar solicitud</button>
    </form>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API = "TU_URL_DE_APPS_SCRIPT";

let catalogo = {};
let directorio = [];

/* ================= LOAD ================= */
fetch(API)
  .then(r=>r.json())
  .then(data=>{
    catalogo = data.catalogo;
    directorio = data.directorio;
    cargarPaises();
    pintar(directorio);
  });

/* ================= FILTROS ================= */
function cargarPaises(){
  pais.innerHTML="<option>País</option>";
  Object.keys(catalogo).forEach(p=>pais.innerHTML+=`<option>${p}</option>`);
}

pais.onchange=()=>{
  entidad.innerHTML="<option>Entidad</option>";
  certificacion.innerHTML="<option>Certificado</option>";
  Object.keys(catalogo[pais.value]||{}).forEach(e=>{
    entidad.innerHTML+=`<option>${e}</option>`;
  });
  filtrar();
};

entidad.onchange=()=>{
  certificacion.innerHTML="<option>Certificado</option>";
  (catalogo[pais.value]?.[entidad.value]||[]).forEach(c=>{
    certificacion.innerHTML+=`<option>${c}</option>`;
  });
  certificacion.innerHTML+=`<option>OTRO</option>`;
  filtrar();
};

certificacion.onchange=filtrar;

function filtrar(){
  let r = directorio;
  if(pais.value!=="País") r=r.filter(x=>x.PAÍS===pais.value);
  if(entidad.value!=="Entidad") r=r.filter(x=>x.ENTIDAD===entidad.value);
  if(certificacion.value!=="Certificado") r=r.filter(x=>x.CERTIFICADO===certificacion.value);
  pintar(r);
}

/* ================= GRID ================= */
function pintar(lista){
  grid.innerHTML="";
  lista.forEach(p=>{
    grid.innerHTML+=`
      <div class="card">
        <h4>${p.EMPRESA}</h4>
        <p>${p.SERVICIO}</p>
        <p>${p.ENTIDAD}, ${p.PAÍS}</p>
        <p><b>${p.CERTIFICADO}</b></p>
        <p>${p.TELÉFONO}</p>
        <p>${p.CORREO}</p>
      </div>`;
  });
}

/* ================= POPUP ================= */
function abrirFormulario(){
  popup.style.display="flex";
  fPais.innerHTML=pais.innerHTML;
  fEntidad.innerHTML=entidad.innerHTML;
  fCert.innerHTML=certificacion.innerHTML;
}

function cerrar(){ popup.style.display="none"; }

popup.onclick=e=>{ if(e.target===popup) cerrar(); }
document.onkeydown=e=>{ if(e.key==="Escape") cerrar(); }

servicio.oninput=()=>servicio.value=servicio.value.toUpperCase();
otroCert.oninput=()=>otroCert.value=otroCert.value.toUpperCase();

fCert.onchange=e=>{
  otroCert.style.display = e.target.value==="OTRO"?"block":"none";
};

/* ================= SUBMIT ================= */
form.onsubmit=e=>{
  e.preventDefault();
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      PAÍS:fPais.value,
      ENTIDAD:fEntidad.value,
      CERTIFICADO:fCert.value==="OTRO"?otroCert.value:fCert.value,
      SERVICIO:servicio.value.toUpperCase(),
      EMPRESA:form.EMPRESA.value,
      TELÉFONO:form.TELÉFONO.value,
      CORREO:form.CORREO.value
    })
  }).then(()=>{
    alert("Solicitud enviada correctamente");
    cerrar();
    form.reset();
  });
};
</script>

</body>
</html>
